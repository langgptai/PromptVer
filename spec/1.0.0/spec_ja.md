# プロンプトセマンティックバージョニング仕様 (PromptVer) 1.0.0

> LangGPTコミュニティによる提案 | 作成者：云中江树

## 概要

バージョン番号 **MAJOR.MINOR.PATCH** を使用し、以下の規則で増加させます：

- **MAJOR** バージョン：動作契約に互換性のない変更を加えた場合
- **MINOR** バージョン：後方互換性のある方法で機能を追加した場合
- **PATCH** バージョン：後方互換性のある最適化や修正を行った場合

**モデル識別子**と**ビルドメタデータ**の追加ラベルを付加できます。

---

## はじめに

AIアプリケーションの普及に伴い、プロンプトは重要な本番資産となりました。しかし、統一されたバージョニング標準の欠如により：

- **統合リスク**：プロンプトのアップグレードが既存機能を破壊するか不明確
- **協力困難**：チームメンバーがバージョン間の違いを理解しづらい
- **保守混乱**：プロンプトの進化履歴と互換性を追跡できない

**PromptVer** は、これらの問題を解決するため、明確で予測可能なバージョニング仕様を提供します。

PromptVerは、LangGPTエコシステムの重要な構成要素であり、LangGPTの構造化設計理念を完璧に補完します：
- **LangGPT**：良いプロンプトの書き方（構造化設計）
- **PromptVer**：プロンプトバージョンの管理方法（セマンティックバージョニング）

---

## 中核概念

### 1. 動作契約 (Behavioral Contract)

プロンプトの「パブリックAPI」は**動作契約**であり、以下を含みます：

- **出力形式**：テキスト構造、JSONスキーマ、Markdown形式など
- **機能範囲**：約束されたタスクタイプと能力の境界
- **中核制約**：言語、トーン、長さ、安全ルールなどの重要な制限
- **期待される動作**：標準シナリオでの応答パターン

### 2. 後方互換性 (Backward Compatibility)

以下の条件を満たす場合、バージョンBはバージョンAと後方互換性があると見なされます：

- バージョンAのすべての有効な入力が、バージョンBで**意味的に同等**の出力を生成
- バージョンBの出力形式に、バージョンAの必須フィールドがすべて含まれる
- バージョンBは、バージョンAで宣言された中核制約に違反しない

---

## PromptVer 仕様

### 規則 1：動作契約の宣言

PromptVerを使用するプロンプトは、動作契約を宣言**しなければなりません**。契約は以下の方法で定義できます：

- 構造化されたメタデータファイル（推奨）
- プロンプトファイルのヘッダーコメント
- 独立したドキュメント

**メタデータの例：**

```yaml
# prompt_contract.yaml
version: "1.2.3"
contract:
  output_format: "JSON"
  output_schema:
    type: "object"
    required: ["response", "sentiment"]
  capabilities:
    - "customer_inquiry"
    - "complaint_handling"
  constraints:
    language: "ja"
    tone: "professional"
    max_length: 500
```

### 規則 2：バージョン番号の形式

通常のバージョン番号は `MAJOR.MINOR.PATCH` の形式を取らなければなりません：

- 3つの数字はすべて非負整数
- 先頭ゼロを含んではならない
- 各要素は数値的に増加しなければならない

例：`1.0.0` → `1.1.0` → `1.1.1` → `2.0.0`

### 規則 3：初期開発フェーズ

- メジャーバージョンゼロ（`0.y.z`）は初期開発を示す
- このフェーズ中、何でもいつでも変更される可能性がある
- 動作契約は安定していると見なすべきではない

### 規則 4：安定版のリリース

バージョン `1.0.0` は安定した動作契約を定義します。リリース条件：

- プロンプトが本番環境で使用されている
- 動作契約が明確に定義されている
- チームが後方互換性の維持を約束

### 規則 5：PATCHバージョンのインクリメント

**後方互換性のある最適化や修正**を行う場合、PATCHバージョン（`x.y.Z`）をインクリメント：

- ✅ 誤字や文法エラーの修正
- ✅ 明確性のための指示文の改善（動作を変更せず）
- ✅ 例示データの調整（機能を変更せず）
- ✅ パフォーマンス最適化（例：トークン使用量の削減）

**例：**
```
v1.2.0 → v1.2.1
変更：「あなた」の表記を統一
```

### 規則 6：MINORバージョンのインクリメント

**後方互換性のある方法で機能を追加**する場合、MINORバージョン（`x.Y.z`）をインクリメント：

- ✅ 新しいユースケースや機能モジュールの追加
- ✅ 出力形式の拡張（オプションフィールドの追加）
- ✅ 新しい例やエッジケース処理の追加
- ✅ 機能を非推奨としてマーク（ただし保持）

MINORバージョンのインクリメント時、PATCHバージョンを0にリセット**しなければなりません**。

**例：**
```
v1.2.3 → v1.3.0
変更：返金申請処理シナリオを追加
契約：既存の顧客サービス機能を維持
```

### 規則 7：MAJORバージョンのインクリメント

**後方互換性のない変更**を行う場合、MAJORバージョン（`X.y.z`）をインクリメント：

- ⚠️ 出力形式構造の変更
- ⚠️ 中核機能定義やロール設定の変更
- ⚠️ 既存の機能やフィールドの削除
- ⚠️ 中核制約の変更（例：言語、トーンの変更）

MAJORバージョンのインクリメント時、MINORとPATCHを0にリセット**しなければなりません**。

**例：**
```
v1.3.2 → v2.0.0
変更：出力を平文からJSON形式に変更
影響：すべての呼び出し側が解析ロジックの変更が必要
```

### 規則 8：モデル識別子（オプション）

バージョン番号の後に `@model-name` を使用してモデル識別子を付加できます：

```
v1.2.3@gpt-4-turbo
v1.2.3@claude-sonnet-4
v2.0.0@gemini-pro
```

**目的：**
- プロンプトがテストおよび最適化されたモデルを示す
- クロスモデル互換性の問題を警告

### 規則 9：プレリリースバージョン

プレリリースバージョンは、PATCHの後に `-` と識別子を付加して表します：

```
v1.0.0-alpha        # 内部テスト
v1.0.0-alpha.1      # 第1ラウンドの修正
v1.0.0-beta         # 公開テスト
v1.0.0-beta.2       # 第2ラウンドの最適化
v1.0.0-rc.1         # リリース候補
v1.0.0              # 正式リリース
```

**規則：**
- 識別子は `[0-9A-Za-z-]` のみ含むことができる
- プレリリースバージョンは通常バージョンより優先度が低い
- 例：`1.0.0-alpha < 1.0.0`

### 規則 10：ビルドメタデータ

ビルドメタデータは `+` を使用して付加し、非機能情報を示します：

```
v1.2.3+20251005              # ビルド日
v1.2.3+customer-service      # 機能識別子
v1.2.3-beta+exp.sha.a1b2c3   # 実験版 + Git hash
```

**注：** ビルドメタデータはバージョンの優先順位に影響しません。

---

## ベストプラクティス

### MAJORバージョンをインクリメントすべき時は？

✅ **インクリメントすべき：**
- JSONスキーマの必須フィールドの変更
- 出力言語を中国語から英語に変更
- 既存の機能モジュールの削除

❌ **インクリメントすべきでない：**
- 新しいオプションのJSONフィールドの追加
- 内部実装の最適化（ユーザーに知覚されない）
- 例示データの更新

### 迅速な反復戦略

`0.x.x` フェーズで迅速に実験：

```
v0.1.0  初期バージョン
v0.2.0  日次の迅速な反復
v0.3.0  互換性保証なし
...
v1.0.0  安定後にリリース
```

### 非推奨プロセス

機能を非推奨としてマークする標準プロセス：

```
v1.5.0  新機能Xを追加、旧機能Yを非推奨としてマーク
v1.6.0  機能Yを継続保持、再度警告
v2.0.0  機能Yを削除
```

---

## バージョン検証正規表現

完全なPromptVer形式（オプションのモデル識別子付き）：

```regex
^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?(?:@([a-z0-9-]+))?$
```

**一致する例：**
- `1.2.3` ✅
- `1.2.3-alpha` ✅
- `1.2.3+20251005` ✅
- `1.2.3@gpt-4` ✅
- `1.2.3-beta+build@claude` ✅
- `v1.2.3` ❌ (vプレフィックスなし)

---

## PromptVerの採用

本仕様を採用する場合、READMEにバッジを追加してください：

```markdown
[![PromptVer](https://img.shields.io/badge/PromptVer-1.0.0-blue.svg)](https://github.com/langgptai/promptver)
```

プロンプトファイルヘッダーに記載：

```
# Customer Service Prompt
# Version: 1.2.3
# PromptVer: 1.0.0
# License: MIT
```

---

## まとめ

PromptVerは、明確で予測可能なプロンプトバージョニング仕様を提供し、チームを支援します：

- ✅ バージョン間の互換性関係を明確に理解
- ✅ プロンプトを安全にアップグレードおよびロールバック
- ✅ 効果的な協力と知識の伝達
- ✅ 統合リスクの削減

**今日からPromptVerを使用して、プロンプトバージョン管理をより専門的にしましょう！**

---

## ライセンス

本仕様はCC BY 4.0でライセンスされています。

**仕様バージョン：** PromptVer 1.0.0  
**リリース日：** 2025-10-05  
**メンテナー：** LangGPTコミュニティ
